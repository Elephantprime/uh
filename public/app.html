<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNHINGED — App</title>
  <meta name="theme-color" content="#E11D2A" />
  <style>
    :root{ --red:#E11D2A; --panel:#171923; --muted:#b8b9c6; --radius:16px; }
    *{box-sizing:border-box}
    html,body{margin:0;background:#0f0f12;color:#fff;font:500 16px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1280px;margin:0 auto;padding:16px}
    header{border-bottom:1px solid rgba(255,255,255,.06)}
    .bar{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .logo{display:flex;align-items:center;gap:10px}
    .mark{width:28px;height:28px;background:var(--red);border-radius:8px}
    .word{font-weight:1000}
    nav{display:flex;gap:10px}
    .btn{display:inline-flex;align-items:center;border:1px solid rgba(255,255,255,.12);padding:10px 14px;border-radius:12px;font-weight:800;background:transparent;cursor:pointer}
    .btn.primary{background:var(--red);border-color:var(--red)}
    .btn.ghost{background:transparent}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);overflow:hidden}
    .card h2{margin:0;padding:14px;border-bottom:1px solid rgba(255,255,255,.06);background:#12131a}
    .card-body{padding:14px}

    /* Big 2x2 layout */
    .gridTop{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    .gridBottom{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    .bigPane{min-height:55vh}
    .smallPane{min-height:40vh}

    /* Live stream placeholder */
    .live-box{aspect-ratio:16/9;min-height:48vh;background:#000;border-radius:14px;display:flex;align-items:center;justify-content:center}

    /* Chat */
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .muted{color:var(--muted)}
    input,select{padding:10px;border-radius:10px;border:1px solid #2a2c3a;background:#12131a;color:#fff}
    .chat-feed{height:40vh;min-height:420px;overflow:auto;background:#0e0f14;border:1px solid #2a2c39;border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:8px}
    .bubble{max-width:78%;padding:10px 12px;border-radius:12px;word-wrap:break-word}
    .me{align-self:flex-end;background:var(--red)}
    .them{align-self:flex-start;background:#2a2a36}
    .chat-send{display:flex;gap:8px;margin-top:10px}
    .chat-send input{flex:1}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:#0009;display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
    .modal{width:100%;max-width:420px;background:#171923;border:1px solid #2a2c39;border-radius:14px;padding:14px}
    .modal h3{margin:0 0 8px}

    @media (max-width:960px){
      .gridTop,.gridBottom{grid-template-columns:1fr}
      .chat-feed{height:36vh}
      .live-box{min-height:36vh}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap bar">
      <div class="logo"><div class="mark"></div><div class="word">UNHINGED</div></div>
      <nav>
        <a class="btn" href="./profile.html">Profile</a>
        <a class="btn" href="./login.html">Log in</a>
        <a class="btn primary" href="./signup.html">Join</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- TOP ROW -->
    <div class="gridTop">
      <!-- Live Stream (big) -->
      <section class="card bigPane">
        <h2>Live Stream</h2>
        <div class="card-body">
          <div class="live-box"><span style="opacity:.65">[ Embed live stream here ]</span></div>
        </div>
      </section>

      <!-- Chat Room (big) -->
      <section class="card bigPane">
        <h2>Chat Room</h2>
        <div class="card-body">
          <!-- Header controls -->
          <div class="row" style="justify-content:space-between">
            <div class="muted" id="meTag">(not in chat)</div>
            <div class="row">
              <button class="btn" id="enterChatBtn">Enter Chat</button>
              <button class="btn" id="leaveChatBtn" style="display:none">Leave</button>
            </div>
          </div>

          <!-- Room selector -->
          <div class="row" id="roomBar" style="margin-top:10px;display:none">
            <label class="muted" for="roomSelect">Room</label>
            <select id="roomSelect"></select>
          </div>

          <!-- Feed -->
          <div class="chat-feed" id="chatFeed" aria-live="polite" style="margin-top:10px"></div>

          <!-- Send -->
          <div class="chat-send" id="sendRow" style="display:none">
            <input id="chatInput" placeholder="Type a message…" />
            <button class="btn primary" id="chatSend">Send</button>
          </div>
        </div>
      </section>
    </div>

    <!-- BOTTOM ROW -->
    <div class="gridBottom">
      <!-- Chaos Board -->
      <section class="card smallPane">
        <h2>Chaos Board</h2>
        <div class="card-body">
          <button class="btn primary" id="uploadChaos">Submit Chaos Story</button>
          <div id="chaosList" style="margin-top:12px">[ Chaos stories will appear here ]</div>
        </div>
      </section>

      <!-- Review Board -->
      <section class="card smallPane">
        <h2>Review Board</h2>
        <div class="card-body" id="reviewList">[ Reviews will appear here ]</div>
      </section>
    </div>
  </main>

  <!-- Enter Chat Modal -->
  <div class="modal-backdrop" id="enterModal">
    <div class="modal">
      <h3>Enter Chat</h3>
      <p class="muted" style="margin:6px 0 10px">Pick the name everyone will see in rooms.</p>
      <label for="usernameInput" class="muted" style="display:block;margin-bottom:6px">Username</label>
      <input id="usernameInput" placeholder="e.g., @ChaosBoss" />
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn" id="cancelEnter">Cancel</button>
        <button class="btn primary" id="confirmEnter">Enter</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Chat (local/in-browser for now) =====
    const ROOMS = ["#general", "#first-dates", "#gym-rats", "#chaos-lounge"];
    let myName = localStorage.getItem("uh_chat_name") || "";
    let currentRoom = ROOMS[0];
    const messages = new Map(ROOMS.map(r => [r, []])); // per-room arrays

    // DOM
    const meTag = document.getElementById("meTag");
    const enterChatBtn = document.getElementById("enterChatBtn");
    const leaveChatBtn = document.getElementById("leaveChatBtn");
    const roomBar = document.getElementById("roomBar");
    const roomSelect = document.getElementById("roomSelect");
    const chatFeed = document.getElementById("chatFeed");
    const sendRow = document.getElementById("sendRow");
    const chatInput = document.getElementById("chatInput");
    const chatSend = document.getElementById("chatSend");

    // Modal
    const enterModal = document.getElementById("enterModal");
    const usernameInput = document.getElementById("usernameInput");
    const cancelEnter = document.getElementById("cancelEnter");
    const confirmEnter = document.getElementById("confirmEnter");

    // Helpers
    function openEnter(){ usernameInput.value = myName || ""; enterModal.style.display = "flex"; setTimeout(()=>usernameInput.focus(), 0); }
    function closeEnter(){ enterModal.style.display = "none"; }
    function setSigned(on){
      meTag.textContent = on ? `Signed in as ${myName}` : "(not in chat)";
      enterChatBtn.style.display = on ? "none" : "inline-flex";
      leaveChatBtn.style.display = on ? "inline-flex" : "none";
      roomBar.style.display = on ? "flex" : "none";
      sendRow.style.display = on ? "flex" : "none";
    }
    function renderRooms(){
      roomSelect.innerHTML = "";
      ROOMS.forEach(r=>{
        const opt = document.createElement("option");
        opt.value = r; opt.textContent = r;
        if (r === currentRoom) opt.selected = true;
        roomSelect.appendChild(opt);
      });
    }
    function renderFeed(){
      chatFeed.innerHTML = "";
      (messages.get(currentRoom) || []).forEach(m=>{
        const b = document.createElement("div");
        b.className = "bubble " + (m.from === myName ? "me" : "them");
        b.textContent = `${m.from}: ${m.text}`;
        chatFeed.appendChild(b);
      });
      chatFeed.scrollTop = chatFeed.scrollHeight;
    }
    function send(){
      const text = chatInput.value.trim();
      if (!text || !myName) return;
      const arr = messages.get(currentRoom);
      arr.push({ from: myName, text, ts: Date.now() });
      chatInput.value = "";
      renderFeed();
    }

    // Events
    enterChatBtn.addEventListener("click", openEnter);
    cancelEnter.addEventListener("click", closeEnter);
    confirmEnter.addEventListener("click", ()=>{
      const v = usernameInput.value.trim();
      if (!v) return;
      myName = v;
      localStorage.setItem("uh_chat_name", myName);
      closeEnter();
      setSigned(true);
      renderRooms();
      renderFeed();
    });
    leaveChatBtn.addEventListener("click", ()=> setSigned(false));
    roomSelect.addEventListener("change", (e)=>{ currentRoom = e.target.value; renderFeed(); });
    chatSend.addEventListener("click", send);
    chatInput.addEventListener("keydown", (e)=>{ if(e.key === "Enter") send(); });
    enterModal.addEventListener("click", (e)=>{ if(e.target===enterModal) closeEnter(); });

    // Init
    (function(){
      setSigned(!!myName);
      renderRooms();
      if (myName) renderFeed();
    })();
  </script>
</body>
</html>
