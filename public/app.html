<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNHINGED â€” Hub</title>
  <meta name="theme-color" content="#E11D2A" />
  <style>
    :root{
      --red:#E11D2A;--ink:#0F0F12;--charcoal:#141418;--card:#161821;--muted:#b8b9c6;
      --radius:16px;--shadow:0 14px 36px rgba(0,0,0,.28)
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:linear-gradient(180deg,#0e0e12,#141418);color:#fff;font:500 16px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    /* Header */
    header{border-bottom:1px solid rgba(255,255,255,.07)}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .bar{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .logo{display:flex;align-items:center;gap:10px}
    .mark{width:26px;height:26px;background:conic-gradient(from 180deg at 50% 50%, var(--red) 0 75%, #8b0e16 75% 100%);border-radius:8px;box-shadow:0 6px 22px rgba(225,29,42,.35)}
    .word{font-weight:1000;letter-spacing:.02em}
    nav{display:flex;gap:10px;flex-wrap:wrap}
    .btn{display:inline-flex;gap:8px;align-items:center;border:1px solid rgba(255,255,255,.12);padding:10px 14px;border-radius:12px;font-weight:800;background:transparent}
    .btn.primary{background:var(--red);border-color:var(--red)}

    /* 2x2 grid */
    .grid{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:minmax(320px,1fr) minmax(320px,1fr);gap:16px}
    .pane{background:linear-gradient(180deg,var(--card),#141620);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;display:flex;flex-direction:column;min-height:300px}
    .pane-header{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .h2{margin:0;font-size:1.1rem;letter-spacing:.02em}
    .action{padding:8px 12px;border-radius:10px;border:1px solid #2a2a2a;background:#222;color:#fff;font-weight:800;cursor:pointer}
    .action.primary{background:var(--red);border-color:var(--red)}

    /* Cards / lists */
    .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-top:10px}
    .card{border:1px solid #2a2a2a;border-radius:12px;background:#1a1b22;padding:10px}
    .cardBtn{border:1px solid #2a2a2a;border-radius:12px;background:#1a1b22;padding:10px;text-align:left;color:#fff;cursor:pointer}

    /* Modal base */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:1000;padding:12px}
    .sheet{width:100%;max-width:720px;background:#141418;border:1px solid #2a2a2a;border-radius:12px;padding:14px}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
    label{display:block;margin:8px 0 4px}
    input[type="text"],textarea{width:100%;padding:10px;border-radius:10px;background:#12131a;border:1px solid #2a2a2a;color:#fff}
    .gridThumb{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px}
    .thumb{border:1px solid #2a2a2a;border-radius:8px;overflow:hidden}
    .thumb img{width:100%;height:120px;object-fit:cover}
    .muted{color:var(--muted);font-size:.9rem}

    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header>
    <div class="wrap bar">
      <div class="logo"><div class="mark"></div><div class="word">UNHINGED</div></div>
      <nav>
        <a class="btn" href="./login.html">Log in</a>
        <a class="btn primary" href="./signup.html">Join</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">

      <!-- START: Chaos Board -->
      <section class="pane" id="chaosPane" aria-labelledby="chaosTitle">
        <div class="pane-header">
          <h2 class="h2" id="chaosTitle">Chaos Board</h2>
          <button class="action primary" id="openChaosForm">Submit Chaos Story</button>
        </div>
        <div id="chaosList" class="list" aria-live="polite"></div>
      </section>
      <!-- END: Chaos Board -->

      <!-- START: Reviews Board -->
      <section class="pane" id="reviewsPane" aria-labelledby="reviewsTitle">
        <div class="pane-header">
          <h2 class="h2" id="reviewsTitle">Reviews</h2>
          <button class="action primary" id="openReviewForm">Submit Review</button>
        </div>
        <div id="reviewsList" class="list" aria-live="polite"></div>
      </section>
      <!-- END: Reviews Board -->

      <!-- START: Live Stream (placeholder visual only) -->
      <section class="pane" id="livePane" aria-labelledby="liveTitle">
        <div class="pane-header">
          <h2 class="h2" id="liveTitle">Live Stream</h2>
          <button class="action" disabled>Connect (soon)</button>
        </div>
        <div class="card muted">Video player placeholder for beta. Weâ€™ll wire this later.</div>
      </section>
      <!-- END: Live Stream (placeholder visual only) -->

      <!-- START: Chat Room (placeholder visual only) -->
      <section class="pane" id="chatPane" aria-labelledby="chatTitle">
        <div class="pane-header">
          <h2 class="h2" id="chatTitle">Chat Room</h2>
          <button class="action" disabled>Join Room (soon)</button>
        </div>
        <div class="card muted">Room list / messages placeholder for beta. Weâ€™ll wire this later.</div>
      </section>
      <!-- END: Chat Room (placeholder visual only) -->

    </div>
  </main>

  <!-- ===================== MODALS ===================== -->

  <!-- START: Chaos â€“ Create Modal -->
  <div class="modal" id="chaosFormModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="chaosFormTitle">
      <div class="row">
        <h3 id="chaosFormTitle" style="margin:0">Submit Chaos Story</h3>
        <button class="action" id="closeChaosForm">Close</button>
      </div>

      <label>Title <small class="muted" id="chaosTitleCounter"></small></label>
      <input id="chaosTitleInput" type="text" placeholder="Walked Out on the Check" />

      <label>Story</label>
      <textarea id="chaosBodyInput" rows="6" placeholder="Tell us what happenedâ€¦"></textarea>

      <label>Photos (optional)</label>
      <input id="chaosPhotosInput" type="file" accept="image/*" multiple />
      <div id="chaosPhotoPreview" class="gridThumb" style="margin-top:8px"></div>

      <div id="chaosFormStatus" class="muted" style="margin-top:6px"></div>

      <div class="row" style="margin-top:10px; justify-content:flex-end;">
        <button class="action primary" id="submitChaos">Post</button>
      </div>
    </div>
  </div>
  <!-- END: Chaos â€“ Create Modal -->

  <!-- START: Chaos â€“ Full View Modal -->
  <div class="modal" id="chaosViewModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="chaosViewTitle">
      <div class="row">
        <h3 id="chaosViewTitle" style="margin:0">Chaos Story</h3>
        <button class="action" id="closeChaosView">Close</button>
      </div>
      <div id="chaosViewPhotos" class="gridThumb" style="margin-bottom:10px"></div>
      <div id="chaosViewBody" style="white-space:pre-wrap; line-height:1.6;"></div>
    </div>
  </div>
  <!-- END: Chaos â€“ Full View Modal -->

  <!-- START: Reviews â€“ Create Modal -->
  <div class="modal" id="reviewFormModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="reviewFormTitle">
      <div class="row">
        <h3 id="reviewFormTitle" style="margin:0">Submit Review</h3>
        <button class="action" id="closeReviewForm">Close</button>
      </div>

      <label>Title <small class="muted" id="reviewTitleCounter"></small></label>
      <input id="reviewTitleInput" type="text" placeholder="Walked Out on the Check" />

      <label>Rating</label>
      <div id="ratingRow" class="row" style="justify-content:flex-start;">
        <button type="button" data-rate="1" class="action">ðŸ”¥</button>
        <button type="button" data-rate="2" class="action">ðŸ”¥ðŸ”¥</button>
        <button type="button" data-rate="3" class="action">ðŸ”¥ðŸ”¥ðŸ”¥</button>
        <button type="button" data-rate="4" class="action">ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥</button>
        <button type="button" data-rate="5" class="action">ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥</button>
        <input id="reviewRatingHidden" type="hidden" value="3" />
      </div>

      <label>Story</label>
      <textarea id="reviewBodyInput" rows="6" placeholder="What happened?"></textarea>

      <label>Photos (optional)</label>
      <input id="reviewPhotosInput" type="file" accept="image/*" multiple />
      <div id="reviewPhotoPreview" class="gridThumb" style="margin-top:8px"></div>

      <div id="reviewFormStatus" class="muted" style="margin-top:6px"></div>

      <div class="row" style="margin-top:10px; justify-content:flex-end;">
        <button class="action primary" id="submitReview">Post</button>
      </div>
    </div>
  </div>
  <!-- END: Reviews â€“ Create Modal -->

  <!-- START: Reviews â€“ Full View Modal -->
  <div class="modal" id="reviewViewModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="reviewViewTitle">
      <div class="row">
        <h3 id="reviewViewTitle" style="margin:0">Review</h3>
        <button class="action" id="closeReviewView">Close</button>
      </div>
      <div id="reviewViewRating" style="margin-bottom:8px; font-size:1.1rem"></div>
      <div id="reviewViewPhotos" class="gridThumb" style="margin-bottom:10px"></div>
      <div id="reviewViewBody" style="white-space:pre-wrap; line-height:1.6;"></div>
    </div>
  </div>
  <!-- END: Reviews â€“ Full View Modal -->

  <!-- ===================== SCRIPTS ===================== -->
  <script>
    /* ===== Config (limits) ===== */
    const TITLE_MAX_CHARS = 60;
    const TITLE_MAX_WORDS = 10;

    /* ===== State (in-memory demo) ===== */
    let CHAOS = [];   // {id,title,body,photos:[objectURL]}
    let REVIEWS = []; // {id,title,rating,body,photos:[objectURL]}

    let chaosPreviewURLs = [];
    let reviewPreviewURLs = [];

    /* ===== DOM: Chaos ===== */
    const chaosList = document.getElementById('chaosList');
    const openChaosForm = document.getElementById('openChaosForm');
    const chaosFormModal = document.getElementById('chaosFormModal');
    const closeChaosForm = document.getElementById('closeChaosForm');
    const chaosTitleInput = document.getElementById('chaosTitleInput');
    const chaosTitleCounter = document.getElementById('chaosTitleCounter');
    const chaosBodyInput = document.getElementById('chaosBodyInput');
    const chaosPhotosInput = document.getElementById('chaosPhotosInput');
    const chaosPhotoPreview = document.getElementById('chaosPhotoPreview');
    const chaosFormStatus = document.getElementById('chaosFormStatus');
    const submitChaos = document.getElementById('submitChaos');

    const chaosViewModal = document.getElementById('chaosViewModal');
    const closeChaosView = document.getElementById('closeChaosView');
    const chaosViewTitle = document.getElementById('chaosViewTitle');
    const chaosViewBody = document.getElementById('chaosViewBody');
    const chaosViewPhotos = document.getElementById('chaosViewPhotos');

    /* ===== DOM: Reviews ===== */
    const reviewsList = document.getElementById('reviewsList');
    const openReviewForm = document.getElementById('openReviewForm');
    const reviewFormModal = document.getElementById('reviewFormModal');
    const closeReviewForm = document.getElementById('closeReviewForm');
    const reviewTitleInput = document.getElementById('reviewTitleInput');
    const reviewTitleCounter = document.getElementById('reviewTitleCounter');
    const reviewBodyInput = document.getElementById('reviewBodyInput');
    const reviewPhotosInput = document.getElementById('reviewPhotosInput');
    const reviewPhotoPreview = document.getElementById('reviewPhotoPreview');
    const submitReview = document.getElementById('submitReview');
    const reviewFormStatus = document.getElementById('reviewFormStatus');
    const ratingRow = document.getElementById('ratingRow');
    const reviewRatingHidden = document.getElementById('reviewRatingHidden');

    const reviewViewModal = document.getElementById('reviewViewModal');
    const closeReviewView = document.getElementById('closeReviewView');
    const reviewViewTitle = document.getElementById('reviewViewTitle');
    const reviewViewBody = document.getElementById('reviewViewBody');
    const reviewViewPhotos = document.getElementById('reviewViewPhotos');
    const reviewViewRating = document.getElementById('reviewViewRating');

    /* ===== Helpers ===== */
    const clampTitle = (str) => {
      if (!str) return '';
      let s = str.slice(0, TITLE_MAX_CHARS);
      const words = s.trim().split(/\s+/);
      if (words.length > TITLE_MAX_WORDS) s = words.slice(0, TITLE_MAX_WORDS).join(' ');
      return s.trim();
    };
    const updateCounter = (el, input) => {
      el.textContent = `${(input.value || '').length}/${TITLE_MAX_CHARS}`;
    };
    const setStatus = (el, msg, ok=false) => {
      el.textContent = msg || '';
      el.style.color = ok ? '#6fdc8c' : '#ffb3b3';
    };
    const flames = (n) => 'ðŸ”¥'.repeat(Math.max(1, Math.min(5, Number(n) || 1)));

    function clearPreviews(list, container){
      list.forEach(u=>URL.revokeObjectURL(u));
      list.length = 0;
      container.innerHTML = '';
    }
    function renderPreviews(files, list, container){
      clearPreviews(list, container);
      [...(files||[])].forEach(f=>{
        const url = URL.createObjectURL(f);
        list.push(url);
        const box = document.createElement('div');
        box.className = 'thumb';
        const img = document.createElement('img');
        img.src = url; img.alt = '';
        box.appendChild(img);
        container.appendChild(box);
      });
    }

    /* ===== Renderers ===== */
    function renderChaosList(){
      chaosList.innerHTML = '';
      if(!CHAOS.length){
        const empty = document.createElement('div');
        empty.className = 'card muted';
        empty.textContent = 'No chaos yet.';
        empty.style.gridColumn = '1 / -1';
        chaosList.appendChild(empty);
        return;
      }
      CHAOS.forEach(c=>{
        const btn = document.createElement('button');
        btn.className = 'cardBtn';
        btn.textContent = c.title;
        btn.title = 'Open story';
        btn.addEventListener('click', ()=> openChaosView(c.id));
        chaosList.appendChild(btn);
      });
    }
    function renderReviewsList(){
      reviewsList.innerHTML = '';
      if(!REVIEWS.length){
        const empty = document.createElement('div');
        empty.className = 'card muted';
        empty.textContent = 'No reviews yet.';
        empty.style.gridColumn = '1 / -1';
        reviewsList.appendChild(empty);
        return;
      }
      REVIEWS.forEach(r=>{
        const btn = document.createElement('button');
        btn.className = 'cardBtn';
        btn.innerHTML = `<div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
                           <strong>${r.title}</strong><span>${flames(r.rating)}</span></div>`;
        btn.addEventListener('click', ()=> openReviewView(r.id));
        reviewsList.appendChild(btn);
      });
    }

    /* ===== Chaos â€“ open/close ===== */
    function openChaosFormModal(){ chaosFormModal.style.display = 'flex'; setStatus(chaosFormStatus,''); updateCounter(chaosTitleCounter, chaosTitleInput); }
    function closeChaosFormModal(){
      chaosFormModal.style.display = 'none';
      chaosTitleInput.value = ''; chaosBodyInput.value = ''; chaosPhotosInput.value = '';
      clearPreviews(chaosPreviewURLs, chaosPhotoPreview); setStatus(chaosFormStatus,''); updateCounter(chaosTitleCounter, chaosTitleInput);
    }
    function openChaosView(id){
      const c = CHAOS.find(x=>x.id===id); if(!c) return;
      chaosViewTitle.textContent = c.title;
      chaosViewBody.textContent = c.body;
      chaosViewPhotos.innerHTML = '';
      (c.photos||[]).forEach(url=>{
        const box = document.createElement('div'); box.className = 'thumb';
        const img = document.createElement('img'); img.src = url; img.alt = '';
        box.appendChild(img); chaosViewPhotos.appendChild(box);
      });
      chaosViewModal.style.display = 'flex';
    }
    function closeChaosViewModal(){ chaosViewModal.style.display = 'none'; chaosViewPhotos.innerHTML = ''; }

    /* ===== Reviews â€“ open/close ===== */
    function openReviewFormModal(){ reviewFormModal.style.display = 'flex'; setStatus(reviewFormStatus,''); updateCounter(reviewTitleCounter, reviewTitleInput); }
    function closeReviewFormModal(){
      reviewFormModal.style.display = 'none';
      reviewTitleInput.value = ''; reviewBodyInput.value = ''; reviewPhotosInput.value = '';
      reviewRatingHidden.value = '3';
      clearPreviews(reviewPreviewURLs, reviewPhotoPreview); setStatus(reviewFormStatus,''); updateCounter(reviewTitleCounter, reviewTitleInput);
    }
    function openReviewView(id){
      const r = REVIEWS.find(x=>x.id===id); if(!r) return;
      reviewViewTitle.textContent = r.title;
      reviewViewBody.textContent = r.body;
      reviewViewRating.textContent = flames(r.rating);
      reviewViewPhotos.innerHTML = '';
      (r.photos||[]).forEach(url=>{
        const box = document.createElement('div'); box.className = 'thumb';
        const img = document.createElement('img'); img.src = url; img.alt = '';
        box.appendChild(img); reviewViewPhotos.appendChild(box);
      });
      reviewViewModal.style.display = 'flex';
    }
    function closeReviewViewModal(){ reviewViewModal.style.display = 'none'; reviewViewPhotos.innerHTML = ''; }

    /* ===== Events: Chaos ===== */
    openChaosForm?.addEventListener('click', openChaosFormModal);
    closeChaosForm?.addEventListener('click', closeChaosFormModal);
    chaosFormModal?.addEventListener('click', e=>{ if(e.target===chaosFormModal) closeChaosFormModal(); });
    closeChaosView?.addEventListener('click', closeChaosViewModal);
    chaosViewModal?.addEventListener('click', e=>{ if(e.target===chaosViewModal) closeChaosViewModal(); });

    chaosPhotosInput?.addEventListener('change', e=> renderPreviews(e.target.files, chaosPreviewURLs, chaosPhotoPreview));
    chaosTitleInput?.addEventListener('input', ()=>{
      const clamped = clampTitle(chaosTitleInput.value); if (clamped !== chaosTitleInput.value) chaosTitleInput.value = clamped;
      updateCounter(chaosTitleCounter, chaosTitleInput);
    });
    submitChaos?.addEventListener('click', ()=>{
      const title = clampTitle((chaosTitleInput.value||'').trim());
      const body  = (chaosBodyInput.value||'').trim();
      if(!title){ setStatus(chaosFormStatus,'Please add a short title.'); return; }
      if(!body){ setStatus(chaosFormStatus,'Please add the story.'); return; }
      const photos = chaosPreviewURLs.slice();
      CHAOS.unshift({ id:'c_'+Date.now()+Math.random().toString(36).slice(2,7), title, body, photos });
      renderChaosList(); closeChaosFormModal();
    });

    /* ===== Events: Reviews ===== */
    openReviewForm?.addEventListener('click', openReviewFormModal);
    closeReviewForm?.addEventListener('click', closeReviewFormModal);
    reviewFormModal?.addEventListener('click', e=>{ if(e.target===reviewFormModal) closeReviewFormModal(); });
    closeReviewView?.addEventListener('click', closeReviewViewModal);
    reviewViewModal?.addEventListener('click', e=>{ if(e.target===reviewViewModal) closeReviewViewModal(); });

    reviewPhotosInput?.addEventListener('change', e=> renderPreviews(e.target.files, reviewPreviewURLs, reviewPhotoPreview));
    reviewTitleInput?.addEventListener('input', ()=>{
      const clamped = clampTitle(reviewTitleInput.value); if (clamped !== reviewTitleInput.value) reviewTitleInput.value = clamped;
      updateCounter(reviewTitleCounter, reviewTitleInput);
    });
    ratingRow?.addEventListener('click', e=>{
      const btn = e.target.closest('[data-rate]'); if(!btn) return;
      const n = Number(btn.getAttribute('data-rate')) || 3;
      reviewRatingHidden.value = n;
      [...ratingRow.querySelectorAll('[data-rate]')].forEach(b=> b.style.borderColor = '#2a2a2a');
      btn.style.borderColor = '#E11D2A';
    });
    submitReview?.addEventListener('click', ()=>{
      const title = clampTitle((reviewTitleInput.value||'').trim());
      const body  = (reviewBodyInput.value||'').trim();
      const rating = Math.max(1, Math.min(5, Number(reviewRatingHidden.value)||3));
      if(!title){ setStatus(reviewFormStatus,'Please add a short title.'); return; }
      if(!body){ setStatus(reviewFormStatus,'Please add the review text.'); return; }
      const photos = reviewPreviewURLs.slice();
      REVIEWS.unshift({ id:'r_'+Date.now()+Math.random().toString(36).slice(2,7), title, rating, body, photos });
      renderReviewsList(); closeReviewFormModal();
    });

    /* initial paint */
    renderChaosList();
    renderReviewsList();
  </script>
</body>
</html>
