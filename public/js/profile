/* ===================== ğŸ”¶ PROFILE.JS (COMPAT-ONLY, MINIMAL) ğŸ”¶ ===================== */

const statusEl   = document.getElementById("statusText");
const matchesEl  = document.getElementById("matchesList");
const browseBtn  = document.getElementById("browseBtn");

function setStatus(t){ if (statusEl) statusEl.textContent = t; }
function clearNode(n){ if (!n) return; while(n.firstChild) n.removeChild(n.firstChild); }

/* ===================== ğŸ”¶ HARD CHECKS ğŸ”¶ ===================== */
if (!window.firebase) {
  setStatus("Firebase not loaded");
  console.error("[profile] window.firebase missing. Ensure /js/firebase.js is before profile.js.");
} else if (!firebase.auth || !firebase.firestore) {
  setStatus("Firebase SDK incomplete");
  console.error("[profile] Missing auth/firestore on firebase.");
}

/* ===================== ğŸ”¶ SHORTCUTS ğŸ”¶ ===================== */
const auth = window.firebase?.auth?.();
const db   = window.firebase?.firestore?.();

/* ===================== ğŸ”¶ RENDER USERS ğŸ”¶ ===================== */
function renderUsers(rows){
  if (!matchesEl) return;
  clearNode(matchesEl);

  const grid = document.createElement("div");
  grid.style.display = "grid";
  grid.style.gridTemplateColumns = "repeat(auto-fill, minmax(220px, 1fr))";
  grid.style.gap = "12px";

  rows.forEach(({id, data}) => {
    const d = data || {};
    const card = document.createElement("div");
    card.style.background = "#17171c";
    card.style.border = "1px solid #23232a";
    card.style.borderRadius = "12px";
    card.style.padding = "12px";

    const img = document.createElement("img");
    img.src = d.photoURL || "/assets/default-avatar.png";
    img.alt = (d.displayName || "User") + " photo";
    img.style.width = "100%";
    img.style.height = "180px";
    img.style.objectFit = "cover";
    img.style.borderRadius = "10px";

    const name = document.createElement("div");
    name.textContent = d.displayName || "Unknown";
    name.style.fontWeight = "700";
    name.style.marginTop = "10px";

    const meta = document.createElement("div");
    meta.style.fontSize = "13px";
    meta.style.opacity = "0.8";
    const ageText = Number.isFinite(d.age) ? ` â€¢ ${d.age}` : "";
    meta.textContent = `${d.location || ""}${ageText}`.trim();

    card.appendChild(img);
    card.appendChild(name);
    if (meta.textContent) card.appendChild(meta);
    grid.appendChild(card);
  });

  matchesEl.appendChild(grid);
}

/* ===================== ğŸ”¶ LOAD MEMBERS (EXCEPT SELF) ğŸ”¶ ===================== */
async function loadMembers(myUid){
  setStatus("Loading membersâ€¦");
  const snap = await db.collection("users").limit(60).get();
  const rows = snap.docs
    .filter(d => d.id !== myUid)
    .map(d => ({ id: d.id, data: d.data() }));
  renderUsers(rows);
  setStatus(`Loaded ${rows.length} members`);
}

/* ===================== ğŸ”¶ AUTH LISTENER ğŸ”¶ ===================== */
auth?.onAuthStateChanged(async (user) => {
  if (!user) {
    setStatus("Not signed in. Redirectingâ€¦");
    try { location.replace("/login.html"); } catch(_) {}
    return;
  }
  setStatus(`Signed in as ${user.email || user.uid}`);
  try { await loadMembers(user.uid); } catch (e) {
    console.error(e); setStatus("Failed to load members");
  }
});

/* ===================== ğŸ”¶ BROWSE BUTTON ğŸ”¶ ===================== */
browseBtn?.addEventListener("click", async () => {
  try {
    const me = auth?.currentUser;
    if (!me) throw new Error("Not signed in");
    await loadMembers(me.uid);
  } catch (e) {
    console.error(e); alert("Could not load matches: " + (e?.message || e));
  }
});

/* ===================== ğŸ”¶ END ğŸ”¶ ===================== */
```î¨0î¨‚
